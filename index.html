<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="UTF-8">
    <title>DVD Screensaver Mini-game</title>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/party-js@latest/bundle/party.min.js"></script>
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat&display=swap" rel="stylesheet">
    <style>
        .blur {
            display: block;
            bottom: 0;
            left: 0;
            position: fixed;
            right: 0;
            top: 0;
            -webkit-backdrop-filter: blur(15px);
            backdrop-filter: blur(15px);
            background-color: rgba(0, 0, 0, 0.5);
            filter: blur(10px);

            -webkit-filter: blur(10px);
            -moz-filter: blur(10px);
            -o-filter: blur(10px);
            -ms-filter: blur(10px);
        }

        html {
            font-family: 'Montserrat', sans-serif;
            height: 100%;
        }
        body {
            background-color: black;
            display: flex;
            justify-content: center;
            width: 100%;
            margin: 0;
            height: 100%;
        }
        canvas {
            width: 100%;
            height: 100%;
            display: block;
        }
        #gameMsg {
            top: 10px;
            transition: opacity 2s;
            opacity: 100%;
            padding: 7px;
            border-radius: 20px;
            background-color: #3b3b3b;
            color: white;
            text-align: center;
            display: none;
            margin: 0;
            z-index: 10;
            position: absolute;
            overflow: hidden;
        }
        #score {
            top: 10px;
            left: 10px;
            transition: opacity 2s;
            opacity: 100%;
            padding: 7px;
            border-radius: 10px;
            background-color: #3b3b3b;
            color: white;
            text-align: center;
            display: none;
            margin: 0;
            z-index: 10;
            position: absolute;
            overflow: hidden;
        }
        #level {
            top: 10px;
            right: 10px;
            transition: opacity 2s;
            opacity: 100%;
            padding: 7px;
            border-radius: 10px;
            background-color: #3b3b3b;
            color: white;
            text-align: center;
            display: none;
            margin: 0;
            z-index: 10;
            position: absolute;
            overflow: hidden;
        }
        #start {
            border: none;
            font-size: 5vw;
            z-index: 5;
            display: none;
            border-radius: 10px;
            padding: 1vw;
            position: absolute;
            top: 40%;
            left: 40%;
            color: #ffffff;
            background-color: rgba(75, 75, 75, 0.9);
        }
        #start:hover {
            background-color: rgba(87, 87, 87, 0.9);
        }
        #score, #level {
            font-weight: bold;
        }
        #score i, #level i {
            color: #00e1ff;
            font-style: normal;
            font-weight: normal;
        }
    </style>
</head>
<body>

<p id="gameMsg"></p>
<p id="score">Total Moves: <i></i></p>
<p id="level">Level: <i></i></p>
<button id="start">Start Game</button>
<div id="overlay" class="blur">
<canvas id="gameCanvas">
    <script>
            //declare variables
            const FPS = 60;
            const canvas = document.getElementById("gameCanvas");
            const context = canvas.getContext("2d");
            let level = 0;
            let score = 0;
            let browserResize = false;
            let tooSmall = false;
            let start = false;
            //array of dvd logo colors
            let img = new Image();
            let arrImages = ["dvdLogo1.png", "dvdLogo2.png", "dvdLogo3.png", "dvdLogo4.png", "dvdLogo5.png"]
            img.src = arrImages[(Math.floor(Math.random() * 4 + 1))];

            //ball size
            let bsWidth = 300;
            let bsHeight = 157;

            //ball position x, y
            let bx, by;

            //ball velocity x, y (in pixels per a second, aka how many pixels it moves per frame)
            let xv, yv;

            // sets ball position to middle of canvas
            //using the documents width/height because canvas height and width is inaccurate when this is set
            bx = document.body.clientWidth / 2;
            by = document.body.clientHeight / 2;

            // random ball starting speed (between 50 and 100 pixels per a second)
            xv = 1;
            yv = 1;

            // random ball direction
            if (Math.floor(Math.random() * 2) === 0) {
                xv = -xv;
            }
            if (Math.floor(Math.random() * 2) === 0) {
                yv = -yv;
            }

            let gameMsg = document.getElementById("gameMsg");
            //keyboard controls that change direction of logo
            let recent = false;
            document.addEventListener('keydown', function (event) {
                if(start == true) {
                    if (browserResize == false) {
                        if (recent == false) {
                            switch (event.code) {
                                case "KeyS":
                                case "ArrowDown":
                                    //Make logo change direction to downwards, if the ball is moving upwards
                                    if (yv < 0) {
                                        score += 1;
                                        recent = true;
                                        setTimeout(function () {
                                            recent = false;
                                        }, 1000);
                                        yv = Math.abs(yv);
                                        break;
                                    } else {
                                        break;
                                    }
                                case "KeyW":
                                case "ArrowUp":
                                    //Make logo change direction to upwards, if the ball is moving downwards
                                    if (yv > 0) {
                                        score += 1;
                                        recent = true;
                                        setTimeout(function () {
                                            recent = false;
                                        }, 1000);
                                        yv = -yv;
                                        break;
                                    } else {
                                        break;
                                    }
                                case "KeyA":
                                case "ArrowLeft":
                                    //Make logo change direction to left, if the ball is moving right
                                    if (xv > 0) {
                                        score += 1;
                                        recent = true;
                                        setTimeout(function () {
                                            recent = false;
                                        }, 1000);
                                        xv = -xv;
                                        break;
                                    } else {
                                        break;
                                    }
                                case "KeyD":
                                case "ArrowRight":
                                    //Make logo change direction to right, if the ball is moving left
                                    if (xv < 0) {
                                        score += 1;
                                        recent = true;
                                        setTimeout(function () {
                                            recent = false;
                                        }, 1000);
                                        xv = Math.abs(xv);
                                        break;
                                    } else {
                                        break;
                                    }
                            }
                        } else {
                            gameMsg.innerHTML = "You can only move once per a second."
                            gameMsg.style.display = "block";
                            gameMsg.style.opacity = "100%";
                            setTimeout(function () {
                                gameMsg.style.opacity = "0%";
                            }, 500)
                        }
                    } else {
                        gameMsg.innerHTML = "You cannot resize the window while the game is running. Refresh your browser to restart."
                        gameMsg.style.display = "block";
                        gameMsg.style.opacity = "100%";
                    }
                }
            });

            function drawConfetti() {
                if (party) {
                    //create confetti effect using party.js
                    party.confetti(party.Rect.fromScreen(), {
                            count: 300 * (window.innerWidth / 1980),
                            countVariation: 0.5,
                            angleSpan: 0,
                            yVelocity: -100,
                            yVelocityVariation: 2,
                            rotationVelocityLimit: 6,
                            scaleVariation: 0.8
                        }
                    );
                    gameMsg.innerHTML = "Congrats! The more levels you complete the faster the ball moves."
                    gameMsg.style.display = "block";
                    gameMsg.style.opacity = "100%";
                    setTimeout(function () {
                        gameMsg.style.opacity = "0%";
                    }, 2000)

                    level += 1;
                    xv = xv * 1.1;
                    yv = yv * 1.1;

                    //resets dvdLogo position so you can't spam it
                    bx = canvas.width / 2;
                    by = canvas.height / 2;
                } else {
                    setTimeout(drawConfetti, 50)
                }
            }

            //ensures the new dvd logo color is different then the current one
            function changeImg() {
                let returnSrc = arrImages[(Math.floor(Math.random() * 4 + 1))];
                if (returnSrc !== img.src) {
                    return returnSrc;
                } else {
                    changeImg();
                }
            }

            let xBounds = false;
            let yBounds = false;

            //responsible for: redrawing canvas per frame, ball movement, dvd logo color change, making the ball bounce off walls, and checking for corner hits
            function update() {
                document.body.querySelector("#level i").innerHTML = level;
                document.body.querySelector("#score i").innerHTML = score;
                if (document.body.clientWidth < img.width * 3 || document.body.clientHeight < img.height * 3) {
                    tooSmall = true;
                }
                if (browserResize == false) {
                    if (tooSmall == false) {
                        //move the ball
                        bx += xv;
                        by += yv;

                        //bounce the ball off each wall
                        if (bx - bsWidth / 2 < 0 && xv < 0) {
                            yBounds === true && drawConfetti();
                            xBounds = true;
                            setTimeout(function () {
                                xBounds = false;
                            }, 50)
                            xv = -xv;
                            img.src = changeImg();
                        }
                        //checking if ball position is more than the width of the canvas and if velocity is more than 0
                        if (bx + bsWidth / 2 > canvas.width && xv > 0) {
                            yBounds === true && drawConfetti();
                            xBounds = true;
                            setTimeout(function () {
                                xBounds = false;
                            }, 50)
                            xv = -xv;
                            img.src = changeImg();
                        }
                        if (by - bsHeight / 2 < 0 && yv < 0) {
                            xBounds === true && drawConfetti();
                            yBounds = true;
                            setTimeout(function () {
                                yBounds = false;
                            }, 50)
                            yv = -yv;
                            img.src = changeImg();
                        }
                        if (by + bsHeight / 2 > canvas.height && yv > 0) {
                            xBounds === true && drawConfetti();
                            yBounds = true;
                            setTimeout(function () {
                                yBounds = false;
                            }, 50)
                            yv = -yv;
                            img.src = changeImg();
                        }

                        //draw background and dvd logo
                        context.fillStyle = "black";
                        context.fillRect(0, 0, canvas.width, canvas.height);
                        context.drawImage(img, bx - bsWidth / 2, by - bsHeight / 2);
                    } else {
                        gameMsg.innerHTML = "Your browser window is too small. Resize your browser and refresh the page. Mobile is currently not supported."
                        gameMsg.style.display = "block";
                        gameMsg.style.position = "absolute";
                        gameMsg.style.top = "50%";
                        gameMsg.style.margin = "auto";
                        gameMsg.style.opacity = "100%";
                        document.body.style.backgroundColor = "black";
                    }
                } else {
                    gameMsg.innerHTML = "You cannot resize the window while the game is running. Refresh your browser to restart."
                    gameMsg.style.display = "block";
                    gameMsg.style.position = "absolute";
                    gameMsg.style.top = "50%";
                    gameMsg.style.margin = "auto";
                    gameMsg.style.opacity = "100%";
                    document.body.style.backgroundColor = "black";
                }
                window.requestAnimationFrame(update);
            }
            window.addEventListener('resize', function(){
                browserResize = true;
            })
            //Calls the update function every 1/30th of a second
            window.requestAnimationFrame(update);

    </script>
    <h1>Your browser is out of date.</h1>
    <p><a href="https://browser-update.org/update-browser.html?1">Update</a> your browser to view this site.</p>
</canvas>
</div>
<script>
    function resize() {
        let canvas = document.getElementById('gameCanvas');
        canvas.width = document.body.clientWidth;
        canvas.height = document.body.clientHeight;
    }

    document.body.querySelector("#start").addEventListener('click', function(){
        start = true;
        document.querySelector("#start").style.display = "none";
        document.querySelector("#level").style.display = "block";
        document.querySelector("#score").style.display = "block";
        document.querySelector("#overlay").classList.remove("blur");
    });


    window.addEventListener('resize', resize);
    resize();
    window.addEventListener('load', function(){
    if (document.body.clientWidth >= img.width * 3 && document.body.clientHeight >= img.height * 3)
            document.querySelector("#start").style.display = "block";
    });
</script>
</body>
</html>